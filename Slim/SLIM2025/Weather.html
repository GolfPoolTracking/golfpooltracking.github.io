
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SLIM 2025 - Weather Forecast</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    h1 { text-align: center; }
    h2 { margin-top: 30px; }
    .timestamp { text-align: center; font-size: 0.9em; color: #666; margin-bottom: 20px; }
    .forecast-group { margin-bottom: 40px; }
    .cards { display: flex; flex-wrap: wrap; gap: 15px; }
    .card {
      background: white;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      width: 140px;
      text-align: center;
    }
    .card img { width: 50px; height: 50px; }
    .wind { font-size: 14px; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>SLIM 2025 - Weather Forecast</h1>
  <div id="timestamp" class="timestamp"></div>
  <div id="forecast"></div>

  <script>
    async function loadForecast() {
      try {
        const resp = await fetch("../../forecast_data/forecast.json");
        if (!resp.ok) throw new Error("Fetch failed");
        const data = await resp.json();

        // Display timestamp
        document.getElementById("timestamp").textContent =
          "Last updated: " + new Date(data.timestamp).toLocaleString();

        // Group forecasts by label
        const grouped = {};
        data.forecasts.forEach(f => {
          if (!grouped[f.group]) grouped[f.group] = [];
          grouped[f.group].push(f);
        });

        const forecastDiv = document.getElementById("forecast");
        forecastDiv.innerHTML = "";

        const groupNames = {
          "Portsalon_28Aug": "Thursday 28 Aug - Portsalon (11am–7pm)",
          "Downings_29Aug": "Friday 29 Aug - Downings (11am–7pm)",
          "Downings_30Aug": "Saturday 30 Aug - Downings (11am–7pm)",
          "Downings_31Aug": "Sunday 31 Aug - Downings (7am–3pm)"
        };

        for (const [label, entries] of Object.entries(grouped)) {
          const gDiv = document.createElement("div");
          gDiv.className = "forecast-group";

          const title = document.createElement("h2");
          title.textContent = groupNames[label] || label;
          gDiv.appendChild(title);

          const cardsDiv = document.createElement("div");
          cardsDiv.className = "cards";

          entries.forEach(e => {
            const card = document.createElement("div");
            card.className = "card";

            const time = new Date(e.time);
            const timeStr = time.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});

            const iconUrl = e.WeatherSymbol3
              ? `https://www.met.ie/Open_Data/Weather_Forecast_Symbols/${e.WeatherSymbol3}.png`
              : "";

            const windDir = degToCompass(e.WindDirection);
            const windArrow = degToArrow(e.WindDirection);
            const wind = e.WindSpeed !== undefined ? `${e.WindSpeed} km/h ${windDir} ${windArrow}` : "";

            card.innerHTML = `
              <h3>${timeStr}</h3>
              <div>${e.Temperature !== undefined ? e.Temperature + '°C' : ''}</div>
              <div>${iconUrl ? `<img src="${iconUrl}" alt="icon">` : ''}</div>
              <div>${e.Rainfall !== undefined ? 'Rain: ' + e.Rainfall + ' mm' : ''}</div>
              <div class="wind">${wind}</div>
            `;

            cardsDiv.appendChild(card);
          });

          gDiv.appendChild(cardsDiv);
          forecastDiv.appendChild(gDiv);
        }
      } catch (err) {
        document.getElementById("forecast").innerHTML = "<p>Error loading forecast.</p>";
        console.error(err);
      }
    }

    function degToCompass(num) {
      if (num === undefined) return "";
      const val = Math.floor((num / 22.5) + 0.5);
      const arr = ["N","NNE","NE","ENE","E","ESE","SE","SSE",
                   "S","SSW","SW","WSW","W","WNW","NW","NNW"];
      return arr[val % 16];
    }

    function degToArrow(num) {
      if (num === undefined) return "";
      const arrows = ["↑","↗","→","↘","↓","↙","←","↖"];
      const val = Math.floor((num / 45) + 0.5);
      return arrows[val % 8];
    }

    loadForecast();
  </script>
</body>
</html>
