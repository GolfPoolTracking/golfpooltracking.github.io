<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microsoft Graph Excel Demo</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css">
</head>
<body class="p-4">
  <h1 class="mb-4">Golf Pool Results (Demo)</h1>

  <button id="signin" class="btn btn-primary mb-3">Sign in with Microsoft</button>

  <div id="results-container" class="table-responsive">
    <p class="text-muted">Sign in to load data from Excel...</p>
  </div>

  <!-- MSAL.js (Microsoft Authentication Library) -->
  <script src="https://alcdn.msauth.net/browser/2.25.0/js/msal-browser.min.js"></script>

  <script>
  // ======== CONFIGURE THESE =========
  const clientId = "YOUR_APP_CLIENT_ID";  // from Azure App Registration
  const redirectUri = window.location.origin + "/graph-demo/auth.html";
  const filePath = "/Documents/Golf/SLIM 2026.xlsm";  // path in OneDrive/SharePoint
  const rangeName = "Website_Results";               // Excel named range
  // ===================================

  const msalConfig = {
      auth: { clientId: clientId, redirectUri: redirectUri }
  };
  const msalInstance = new msal.PublicClientApplication(msalConfig);
  const loginRequest = { scopes: ["Files.Read"] };

  document.getElementById("signin").onclick = async () => {
      const loginResp = await msalInstance.loginPopup(loginRequest);
      const account = loginResp.account;
      msalInstance.setActiveAccount(account);
      const tokenResp = await msalInstance.acquireTokenSilent({
          ...loginRequest, account
      }).catch(() => msalInstance.acquireTokenPopup(loginRequest));

      const token = tokenResp.accessToken;
      const url = `https://graph.microsoft.com/v1.0/me/drive/root:${filePath}:/workbook/names('${rangeName}')/range`;

      const resp = await fetch(url, {
          headers: { "Authorization": `Bearer ${token}` }
      });
      const data = await resp.json();

      renderTable(data.values);
  };

  function renderTable(values) {
      const table = document.createElement("table");
      table.className = "table table-striped table-bordered";
      values.forEach((row, i) => {
          const tr = document.createElement("tr");
          row.forEach(cell => {
              const tag = i === 0 ? "th" : "td";
              const td = document.createElement(tag);
              td.textContent = cell;
              tr.appendChild(td);
          });
          table.appendChild(tr);
      });
      const container = document.getElementById("results-container");
      container.innerHTML = "";
      container.appendChild(table);
  }
  </script>
</body>
</html>
